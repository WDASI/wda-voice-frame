<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Voiceframe Listener</title>
    <meta charset="UTF-8" />
  </head>
  <body>
    <p style="font-family: sans-serif; font-size: 14px; color: #666;">
      Voiceframe listener is ready.
    </p>

    <script>
      console.log("Voiceframe loaded");

      window.addEventListener("message", (event) => {
        console.log("Message received in iframe:", event.data);
        if (event.data.type === "voice-start") {
          startRecognition();
        }
      });

      function startRecognition() {
  if (!("webkitSpeechRecognition" in window)) {
    window.parent.postMessage(
      {
        type: "voice-error",
        message: "Browser does not support webkitSpeechRecognition.",
      },
      "*"
    );
    return;
  }

  const recognition = new webkitSpeechRecognition();
  recognition.continuous = false;
  recognition.interimResults = false;
  recognition.lang = "en-US";

  recognition.onresult = function (event) {
    const transcript = event.results[0][0].transcript;

    console.log("Transcript captured:", transcript);

    // âœ… Send transcript back to parent
    window.parent.postMessage(
      {
        type: "voice-result",
        transcript: transcript,
      },
      "*"
    );
  };

  recognition.onerror = function (event) {
    console.error("Recognition error:", event.error);

    window.parent.postMessage(
      {
        type: "voice-error",
        message: "Speech recognition error: " + event.error,
      },
      "*"
    );
  };

  recognition.onend = function () {
    console.log("Recognition ended.");
    window.parent.postMessage({ type: "voice-end" }, "*");
  };

  recognition.start();
}
    </script>
  </body>
</html>
